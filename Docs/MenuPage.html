<style>
  .selected {
    font-weight: bold;
    color: #d66a1a;
    text-decoration: underline;
  }

  .accordion-header {
    background-color: #f78b20; /* Set section background color */
  }

  .accordion-button:not(.collapsed) {
    font-weight: bold;
    background-color: #f78b20; /* Set section background color */
    color: #FFFFFF;
  }
    .accordion-button {
        font-weight: normal;
        background-color: #f78b20; /* Set section background color */
        color: #FFFFFF;
    }

  .accordion-body ul {
    padding-left: 20px;
  }

    .accordion-body ul li {
      margin-bottom: 5px;
    }

      .accordion-body ul li a {
        text-decoration: none;
        color: #f78b20;
      }

        .accordion-body ul li a:hover {
          color: #d66a1a; /* Slightly darker shade for hover effect */
          text-decoration: underline;
        }

    .accordion-body ul ul {
      margin-top: 5px;
    }
</style>
<div class="search-container mb-3">
  <button id="toggleAllButton" class="btn btn-primary mb-2">Collapse All</button>
  <input type="text" id="menuSearch" class="form-control" placeholder="Search menu...">
</div>
<div id="menuContainer"></div>
<script>

  const menuData = {
    "menu": [
      {
        "title": "Introduction",
        "links": [
          { "text": "What is Multi Commander", "url": "/Docs/WhatIsMultiCommander" },
          { "text": "System Requirements", "url": "/Docs/SystemRequirements" },
          { "text": "Download and Installation", "url": "/Docs/Installation" },
          { "text": "Upgrading", "url": "/Docs/Upgrading" },
          { "text": "License", "url": "/Docs/License" }
        ]
      },
      {
        "title": "Overview / Layout",
        "links": [
          {
            "text": "Main Application Layout",
            "url": "/Docs/mainlayout",
            "subLinks": [
              { "text": "Menu Bar", "url": "/Docs/menubar" },
              { "text": "Standard Command Bar", "url": "/Docs/standarbar" },
              { "text": "File Commands", "url": "/Docs/filecommandbar" },
              { "text": "Drive Bar", "url": "/Docs/drivebar" },
              { "text": "Command line Bar", "url": "/Docs/commandlinebar" },
              { "text": "Quick Launch Bar", "url": "/Docs/quicklaunchbar" },
              { "text": "Status Bar", "url": "/Docs/statusbar" }
            ]
          },
          { "text": "Extensions and Plug-ins", "url": "/Docs/extensions" },
          { "text": "Favorites", "url": "/Docs/favorites" },
          { "text": "Button Panel", "url": "/Docs/buttonpanel" },
          { "text": "Panel Tabs", "url": "/Docs/paneltabs" }
        ]
      },
      {
        "title": "Panels",
        "links": [
          {
            "text": "Explorer Panel",
            "url": "/Docs/ExplorerPanel",
            "subLinks": [
              {
                "text": "Layout",
                "url": "/Docs/ExplorerPanel-Layout",
                "subLinks": [
                  { "text": "Path Field", "url": "/Docs/ExplorerPanelPathField" }
                ]
              },
              { "text": "Navigation", "url": "/Docs/ExplorerPanel2" },
              { "text": "Customize Columns", "url": "/Docs/ExplorerPanel-CustomizeColumns" },
              { "text": "Customize Column Layouts", "url": "/Docs/ExplorerPanel-CustomizeColumnLayouts" },
              { "text": "Folder Tree", "url": "/Docs/ExplorerPanel-FolderTree" },
              { "text": "File Coloring", "url": "/Docs/ExplorerPanel-FileColoring" },
              { "text": "Pasting Clipboard Data into Explorer Panel", "url": "/Docs/ExplorerPanel-PasteFromClipboard" }
            ]
          },
          { "text": "File Search", "url": "/Docs/file-search" }
        ]
      },
      {
        "title": "FileSystem",
        "links": [
          { "text": "Multi Commander's Virtual FileSystem", "url": "/Docs/filesystem" },
          { "text": "Archives (Zip, Rar, 7Zip)", "url": "/Docs/filesystem/archives" },
          { "text": "Network (NET:)", "url": "/Docs/filesystem/network" },
          { "text": "Portable (WPD:)", "url": "/Docs/filesystem/portable" },
          { "text": "Registry (REG:)", "url": "/Docs/browse-registry" },
          { "text": "FTP (FTP:)", "url": "/Docs/browse-ftp" },
          { "text": "SFTP (SFTP:)", "url": "/Docs/filesystem/SFTP" },
          { "text": "Favorites (FAV:)", "url": "/Docs/filesystem/favorites" },
          { "text": "Virtual Folder Group (VFG:)", "url": "/Docs/filesystem/vfg" }
        ]
      },
      {
        "title": "File Operations",
        "links": [
          {
            "text": "Copy/Move Operations",
            "url": "/Docs/copymove_operation",
            "subLinks": [
              { "text": "Copy/Move using Presets", "url": "/Docs/copymove-using-presets" },
              { "text": "Copy/Move using Filters", "url": "/Docs/copymove-using-filters" },
              { "text": "Copy/Move Progress Window", "url": "/Docs/copymove_progress" }
            ]
          },
          { "text": "Delete Operations", "url": "/Docs/delete_operation" },
          {
            "text": "Pack Files",
            "url": "/Docs/packfiles",
            "subLinks": [
              { "text": "Packer Profiles", "url": "/Docs/PackerProfiles" },
              { "text": "External Packers", "url": "/Docs/ExternalPackers" }
            ]
          },
          { "text": "Unpack Files", "url": "/Docs/unpackfiles" }
        ]
      },
      {
        "title": "Extensions",
        "links": [
          { "text": "MultiRename", "url": "/Docs/MultiRename" },
          {
            "text": "File Checksum",
            "url": "/Docs/FileCheckSum",
            "subLinks": [
              { "text": "Create", "url": "/Docs/FileVerifier/Create" },
              { "text": "Verify", "url": "/Docs/FileVerifier/Verify" }
            ]
          },
          { "text": "MultiDataViewer - The File Viewer", "url": "/Docs/fileviewer" },
          { "text": "Internal Picture Viewer", "url": "/Docs/MCPictureViewer" },
          { "text": "Language Editor", "url": "/Docs/LanguageEditor" }
        ]
      },
      {
        "title": "Tools",
        "links": [
          { "text": "Select/Unselect files and folders", "url": "/Docs/selection" },
          { "text": "Calculate Folder Size", "url": "/Docs/CalculateFolderSize" },
          { "text": "Change File Properties", "url": "/Docs/ChangeFileProperties" },
          { "text": "Create Folders", "url": "/Docs/CreateFolders" },
          { "text": "Correct Folder Date/Time", "url": "/Docs/correctfoldertime" },
          { "text": "Find Opened/Locked Files", "url": "/Docs/find_opened_locked_files" },
          { "text": "Send to the Clipboard", "url": "/Docs/SendToClipboard" },
          { "text": "Rename Tools", "url": "/Docs/RenameTools" },
          {
            "text": "Text Tools",
            "url": "/Docs/TextTools",
            "subLinks": [
              { "text": "Text Conversion Tools", "url": "/Docs/TextConvertTools" },
              { "text": "Sort Lines in Files", "url": "/Docs/SortLinesInFiles" },
              { "text": "Find and Replace in Files", "url": "/Docs/FindAndReplaceInFiles" }
            ]
          },
          { "text": "Base 64 Encoding/Decoding", "url": "/Docs/Base64EncodingDecoding" },
          { "text": "File Security", "url": "/Docs/filesecurity" },
          { "text": "File Checksum Tools", "url": "/Docs/filechecksumTools" },
          { "text": "Picture Tools", "url": "/Docs/picturetools" },
          { "text": "Audio Tools", "url": "/Docs/audiotools" },
          { "text": "Video Tools", "url": "/Docs/videotools" }
        ]
      },
      {
        "title": "Customization and Configuration",
        "links": [
          { "text": "Managing Aliases (Alias Editor)", "url": "/Docs/aliases" },
          { "text": "File Type Setup", "url": "/Docs/filetypesetup" },
          {
            "text": "Button Editor",
            "url": "/Docs/button-editor",
            "subLinks": [
              { "text": "Button Panel - Wizard Mode", "url": "/Docs/ButtonPanelWizardMode" }
            ]
          },
          { "text": "User Menu Editor", "url": "/Docs/UserMenuEditor" },
          {
            "text": "Keyboard Customization (Shortcuts)",
            "url": "/Docs/keyboard-customization",
            "subLinks": [
              { "text": "Default Keyboard Shortcuts (Commander Style)", "url": "/Docs/keyboard-shortcuts/CommanderStyle" },
              { "text": "Default Keyboard Shortcuts (Windows Explorer Style)", "url": "/Docs/keyboard-shortcuts/WindowsExplorerStyle" }
            ]
          },
          { "text": "Custom Context Menu Editor", "url": "/Docs/CustomContextMenu" },
          { "text": "Filters", "url": "/Docs/filters" }
        ]
      },
      {
        "title": "Configuring the Layout",
        "links": [
          { "text": "Core Settings", "url": "/Docs/CoreSettings" },
          { "text": "Explorer Panel Settings", "url": "/Docs/ExplorerPanelSettings" },
          { "text": "Change Look and Feel to Windows Explorer Mode", "url": "/Docs/windows-explorer-look-and-feel" }
        ]
      },
      {
        "title": "User Commands and Scripting",
        "links": [
          { "text": "User Defined Commands", "url": "/Docs/user-defined-commands" },
          { "text": "Internal Commands", "url": "/Docs/UDC_internal" },
          { "text": "External Commands", "url": "/Docs/UDC_external" },
          {
            "text": "Custom Commands",
            "url": "/Docs/UDC_custom",
            "subLinks": [
              { "text": "List of Custom Commands", "url": "/Docs/customcommands_list" },
              { "text": "Examples", "url": "/Docs/customcommands_examples" }
            ]
          },
          { "text": "Batch Script (.BAT)", "url": "/Docs/UDC_batch" },
          {
            "text": "MultiScript",
            "url": "/Docs/UDC_multiscript",
            "subLinks": [
              { "text": "Language Syntax", "url": "/Docs/multiscript/languagesyntax" },
              {
                "text": "Script Functions",
                "subLinks": [
                  { "text": "Type checks and type converters", "url": "/Docs/multiscript/corefunctions" },
                  { "text": "Array functions", "url": "/Docs/multiscript/functions/array" },
                  { "text": "String functions", "url": "/Docs/multiscript/functions/string" },
                  { "text": "RowList functions", "url": "/Docs/multiscript/functions/rowlist" },
                  { "text": "Date/Time functions", "url": "/Docs/multiscript/functions/datetime" },
                  { "text": "File System functions", "url": "/Docs/multiscript/functions/filesystem" },
                  { "text": "Registry functions", "url": "/Docs/multiscript/functions/registry" },
                  { "text": "Panel Selections and Paths", "url": "/Docs/multiscript/functions/getfilefromview" },
                  { "text": "Tab Panel", "url": "/Docs/multiscript/functions/tabpanel" },
                  { "text": "Misc functions", "url": "/Docs/multiscript/functions/misc" }
                ]
              },
              {
                "text": "Extension defined MultiScript functions",
                "subLinks": [
                  { "text": "FTP functions", "url": "/Docs/multiscript/extensions/ftp" },
                  { "text": "Checksum functions", "url": "/Docs/multiscript/extensions/checksum" }
                ]
              },
              { "text": "MultiScript Debugger", "url": "/Docs/UDC_multiscript_debugger" },
              { "text": "Examples", "url": "/Docs/multiscript/examples" }
            ]
          },
          { "text": "MultiTags", "url": "/Docs/multitags" }
        ]
      },
      {
        "title": "Other",
        "links": [
          { "text": "Backup and Restore Configuration", "url": "/Docs/backup_restore_config" },
          { "text": "Cleanup User Data", "url": "/Docs/cleanup_userdata" },
          { "text": "MultiUpdate", "url": "/Docs/MultiUpdate" },
          { "text": "Command Line Parameters", "url": "/Docs/commandlineparameters" },
          { "text": "Custom configuration paths", "url": "/Docs/customized-config-paths" },
          { "text": "Credits and Acknowledgements", "url": "/Docs/credits" }
        ]
      },
      {
        "title": "API",
        "links": [
          { "text": "Multi Commander Windows Message API", "url": "/Docs/MultiCommanderWindowsMessageAPI" }
        ]
      },
      {
        "title": "Troubleshooting",
        "links": [
          { "text": "Multi Commander Hangs and is Not Responding", "url": "/Docs/troubleshooting-hang" },
          { "text": "Multi Commander Crashes", "url": "/Docs/troubleshooting-crash" }
        ]
      },
      {
        "title": "FAQ",
        "links": [
          { "text": "Favorites", "url": "/Docs/faq/favorites" },
          { "text": "Show Hidden files/folders", "url": "/Docs/faq/showhidden" },
          { "text": "Customize Colors", "url": "/Docs/faq/customizecolors" },
          { "text": "Enter folder on Single Click", "url": "/Docs/faq/singleclick" },
          { "text": "Save and Resize Columns", "url": "/Docs/faq/defaultcolumnsetup" }
        ]
      },
      {
        "title": "Index",
        "links": [
          { "text": "Content Index", "url": "/Docs/Índex" }
        ]
      }
    ]
  };

  let allExpanded = true; // Tracks the current state of the sections

  // Function to toggle all sections
  function toggleAllSections() {
    const accordionItems = document.querySelectorAll('.accordion-collapse');
    accordionItems.forEach(item => {
      if (allExpanded) {
        item.classList.remove('show'); // Collapse all sections
      } else {
        item.classList.add('show'); // Expand all sections
      }
    });

    // Update the button text
    const toggleButton = document.getElementById('toggleAllButton');
    toggleButton.textContent = allExpanded ? 'Expand All' : 'Collapse All';

    // Toggle the state
    allExpanded = !allExpanded;
  }


  function AddSubMenu(menuData, parent, indentLevel)
  {
    const subMenu = document.createElement("ul");
    subMenu.className = "list-unstyled ms-" + '${indentLevel}'; // Indent for sublinks
    menuData.forEach(link => {
      const listItem = document.createElement("li");
      const anchor = document.createElement("a");
      anchor.href = link.url;
      anchor.textContent = link.text;

      listItem.appendChild(anchor);
      subMenu.appendChild(listItem);

      if (link.subLinks) {
        AddSubMenu(link.subLinks, listItem, indentLevel+1);
      }
    });
    parent.appendChild(subMenu);
  }

  // Function to build the menu
  function buildMenu(menuData) {
    const menuContainer = document.getElementById("menuContainer");

    // Create the accordion container
    const accordion = document.createElement("div");
    accordion.className = "accordion";
    accordion.id = "docsAccordion";

    menuData.menu.forEach((section, index) => {
      // Create accordion item
      const accordionItem = document.createElement("div");
      accordionItem.className = "accordion-item";

      // Create accordion header
      const headerId = `heading${index}`;
      const collapseId = `collapse${index}`;
      const accordionHeader = document.createElement("h2");
      accordionHeader.className = "accordion-header";
      accordionHeader.id = headerId;

      const accordionButton = document.createElement("button");
      accordionButton.className = "accordion-button";
      accordionButton.type = "button";
      accordionButton.setAttribute("data-bs-toggle", "collapse");
      accordionButton.setAttribute("data-bs-target", `#${collapseId}`);
      accordionButton.setAttribute("aria-expanded", "true");
      accordionButton.setAttribute("aria-controls", collapseId);
      accordionButton.textContent = section.title;

      accordionHeader.appendChild(accordionButton);
      accordionItem.appendChild(accordionHeader);

      // Create accordion collapse
      const accordionCollapse = document.createElement("div");
      accordionCollapse.id = collapseId;
      accordionCollapse.className = "accordion-collapse collapse show"; // Expanded by default
      accordionCollapse.setAttribute("aria-labelledby", headerId);

      const accordionBody = document.createElement("div");
      accordionBody.className = "accordion-body";

      // Create list for links
      const linkList = document.createElement("ul");
      linkList.className = "list-unstyled";

      section.links.forEach(link => {
        const listItem = document.createElement("li");
        const anchor = document.createElement("a");
        anchor.href = link.url;
        anchor.textContent = link.text;

        listItem.appendChild(anchor);

        // Check for subLinks
        if (link.subLinks) {
          AddSubMenu(link.subLinks, listItem, 2);
        }

        linkList.appendChild(listItem);
      });

      accordionBody.appendChild(linkList);
      accordionCollapse.appendChild(accordionBody);
      accordionItem.appendChild(accordionCollapse);

      accordion.appendChild(accordionItem);
    });

    menuContainer.appendChild(accordion);
  }

  function filterSubMenu(parent, searchText)
  {
    let anyMatchFound = false;
    const items = parent.querySelectorAll("li");
    items.forEach(menuItem => {

      let matchFound = false;
      const link = menuItem.querySelector("a");
      const linkText = link.textContent.toLowerCase();

      if (linkText.includes(searchText)) {
        matchFound = true;
      }

      let subMatchFound = filterSubMenu(menuItem, searchText); // Recursively filter sublinks
      if (subMatchFound) {
        matchFound = true;
      }
      if (matchFound) {
        anyMatchFound = true;
        menuItem.style.display = ""; // Show matching link
      }
      else {
        menuItem.style.display = "none"; // Hide non-matching link
      }
    });

    return anyMatchFound;
  }
  
  // Function to filter the menu
  function filterMenu(searchText) {
    const menuContainer = document.getElementById("menuContainer");
    const items = menuContainer.querySelectorAll(".accordion-item");

    items.forEach(item => {
      const sectionTitle = item.querySelector(".accordion-button").textContent.toLowerCase();
      //const links = item.querySelectorAll("a");
      let matchFound = false;

      // Check if the section title matches
      if (sectionTitle.includes(searchText)) {
        matchFound = true;
      }

      let submatchFound = filterSubMenu(item, searchText);
      if (submatchFound) {
        matchFound = true;
      }

      // Show or hide the entire section based on matches
      if (matchFound) {
        item.style.display = "";
      } else {
        item.style.display = "none";
      }
    });
  }

  // Build the menu on page load
  document.addEventListener("DOMContentLoaded", () => {
    const toggleButton = document.getElementById('toggleAllButton');
    toggleButton.addEventListener('click', toggleAllSections);

    buildMenu(menuData);

    // Add the "selected" class to the current menu item
    const currentPath = window.location.pathname;
    const links = document.querySelectorAll("a");

    for (const link of links) {
      const linkPath = new URL(link.href, window.location.origin).pathname; // Extract the pathname

      // Only check URLs that start with "/Docs/"
      if (linkPath.startsWith("/Docs/") && linkPath === currentPath) {
        link.classList.add("selected");
        break; // Stop the loop once a match is found
      }
    }


    // Add event listener for search input
    const searchInput = document.getElementById("menuSearch");
    searchInput.addEventListener("input", (e) => {
      const searchText = e.target.value.toLowerCase();
      filterMenu(searchText);
    });
  });


</script>
